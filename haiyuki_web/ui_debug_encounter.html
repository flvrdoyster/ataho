<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG: Encounter Scene</title>
    <link rel="stylesheet" href="haiyuki.css">
    <style>
        #debug-controls {
            padding: 10px;
            background: #333;
            color: white;
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        select,
        input,
        button {
            padding: 5px;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div id="debug-controls">
        <label>P1: <input type="number" id="p1-idx" value="0" min="0" max="6" style="width: 40px;"></label>
        <label>CPU: <input type="number" id="cpu-idx" value="1" min="0" max="6" style="width: 40px;"></label>
        <label>Mode:
            <select id="mode-select">
                <option value="STORY">STORY (Normal)</option>
                <option value="CHALLENGER">CHALLENGER (Intrusion)</option>
                <option value="ENDING">ENDING (Specific Rival)</option>
                <option value="ENDING_WATCH">ENDING_WATCH (Skip True Check)</option>
                <option value="TRUE_ENDING_CLEAR">TRUE_ENDING_CLEAR</option>
                <option value="WATCH">WATCH (Queue Test)</option>
            </select>
        </label>
        <button onclick="startScene()">Start Scene</button>
        <label><input type="checkbox" id="auto-test"> Auto Test</label>
    </div>

    <div id="main-wrapper">
        <div id="play-area">
            <div id="game-container">
                <canvas id="game-canvas" width="640" height="480"></canvas>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/core/input.js"></script>
    <script src="js/core/assets.js"></script>
    <!-- uiCommon.js REMOVED -->
    <script src="js/data/characterData.js"></script>
    <script src="js/data/dialogueData.js"></script>
    <script src="js/data/battleConfig.js"></script>
    <script src="js/data/paiData.js"></script>

    <script src="js/logic/yakuLogic.js"></script>
    <script src="js/logic/battleMenuSystem.js"></script>
    <script src="js/logic/aiLogic.js"></script>

    <script src="js/scenes/titleScene.js"></script>
    <script src="js/scenes/characterSelectScene.js"></script>
    <script src="js/scenes/encounterScene.js"></script>
    <script src="js/scenes/endingScene.js"></script>
    <script src="js/scenes/continueScene.js"></script>
    <script src="js/scenes/creditsScene.js"></script>

    <script src="js/views/portraitCharacter.js"></script>
    <script src="js/views/battleDialogue.js"></script>
    <script src="js/views/battleRenderer.js"></script>

    <script src="js/logic/battleEngine.js"></script>
    <script src="js/scenes/battleScene.js"></script>

    <script src="js/core/game.js"></script>

    <script>
        // Override Game.init to NOT start TitleScene automatically
        Game.init = function () {
            this.load();
            this.canvas = document.getElementById('game-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.continueCount = 0;

            Input.init(this.canvas);

            Assets.load(() => {
                console.log('Assets loaded. Ready to Start.');
                // Don't auto-start, wait for button
            });
            this.loop(); // Start loop but scene is null initially
        };

        function startScene() {
            const p1 = parseInt(document.getElementById('p1-idx').value);
            const cpu = parseInt(document.getElementById('cpu-idx').value);
            const mode = document.getElementById('mode-select').value;
            const auto = document.getElementById('auto-test').checked;

            Game.isAutoTest = auto;

            const data = {
                playerIndex: p1,
                cpuIndex: cpu,
                mode: mode,
                defeatedOpponents: [],
                queue: (mode === 'WATCH') ? [2, 3, 4] : [] // Dummy queue for watch test
            };

            console.log("Starting Encounter with:", data);
            Game.changeScene(EncounterScene, data);
        }
    </script>
</body>

</html>