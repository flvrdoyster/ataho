<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result UI Debugger</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preload"
        href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/KoddiUDOnGothic-Regular.woff" as="font"
        type="font/woff" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/KoddiUDOnGothic-Bold.woff"
        as="font" type="font/woff" crossorigin>
    <style>
        body {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #333;
            color: white;
            font-family: monospace;
        }

        canvas {
            border: 2px solid white;
            background: #000;
        }

        #controls {
            background: #444;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background: #45a049;
        }

        h3 {
            margin-top: 0;
            border-bottom: 1px solid #777;
            padding-bottom: 5px;
        }
    </style>
</head>

<body>
    <div>
        <canvas id="game-canvas" width="640" height="480"></canvas>
    </div>
    <div id="controls">
        <h3>Result Types</h3>
        <button onclick="setResult({type:'WIN', score:12000, yakuName:'순 적일색'})">WIN (Color - 12000)</button>
        <button onclick="setResult({type:'WIN', score:8000, yakuName:'맹호난무 (필살기)'})">WIN (Char - 8000)</button>
        <button onclick="setResult({type:'LOSE', score:5000, yakuName:'장기'})">LOSE (5000)</button>

        <h3>Nagari Scenarios</h3>
        <button onclick="setResult({type:'NAGARI', damageMsg:'데미지: 없음', p1Status:'노텐', cpuStatus:'노텐'})">NAGARI (Both
            Noten)</button>
        <button onclick="setResult({type:'NAGARI', damageMsg:'데미지: 3000', p1Status:'텐파이', cpuStatus:'노텐'})">NAGARI (P1
            Tenpai)</button>
        <button onclick="setResult({type:'NAGARI', damageMsg:'데미지: -3000', p1Status:'노텐', cpuStatus:'텐파이'})">NAGARI (CPU
            Tenpai)</button>
        <button onclick="setResult({type:'NAGARI', damageMsg:'데미지: 없음', p1Status:'텐파이', cpuStatus:'텐파이'})">NAGARI (Both
            Tenpai)</button>

        <h3>Match</h3>
        <button onclick="setResult({type:'MATCH_WIN'})">MATCH WIN</button>
        <button onclick="setResult({type:'MATCH_LOSE'})">MATCH LOSE</button>

        <h3>State Info</h3>
        <div id="status">Active State: None</div>
    </div>

    <!-- Scripts -->
    <script src="js/core/input.js"></script>
    <script src="js/core/assets.js"></script>
    <script src="js/data/characterData.js"></script>
    <script src="js/data/battleUIConfig.js"></script>
    <script src="js/views/battleRenderer.js"></script>
    <script src="js/scenes/battleScene.js"></script>

    <script>
        // Disable Music
        if (typeof Assets !== 'undefined') {
            Assets.playMusic = function () { console.log("Music suppressed"); };
        }

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        // Mock State
        const MockState = {
            currentState: 0,
            STATE_WIN: 3,
            STATE_LOSE: 4,
            STATE_NAGARI: 5,
            STATE_MATCH_OVER: 6,

            resultInfo: null,
            timer: 0,

            // Mock empty data for renderer safety
            winningYaku: null,
            p1: { hp: 1000, mp: 100 },
            cpu: { hp: 1000, mp: 100 }
        };

        function setResult(info) {
            MockState.resultInfo = info;
            const type = info.type;

            // Map type to state for renderer logic (if needed) or just force draw
            if (type === 'WIN') MockState.currentState = MockState.STATE_WIN;
            else if (type === 'LOSE') MockState.currentState = MockState.STATE_LOSE;
            else if (type === 'NAGARI') MockState.currentState = MockState.STATE_NAGARI;
            else if (type.includes('MATCH')) MockState.currentState = MockState.STATE_MATCH_OVER;

            document.getElementById('status').innerText = `Active: ${type}`;
        }

        // Init
        Assets.load(() => {
            console.log("Assets Loaded");

            // Default to WIN
            setResult({ type: 'WIN', score: 8000, yakuName: '순 적일색' });

            function loop() {
                MockState.timer++;

                // Clear
                ctx.fillStyle = '#333';
                ctx.fillRect(0, 0, 640, 480);

                // Draw Result
                // BattleRenderer.drawResult expects the engine state
                if (MockState.resultInfo) {
                    BattleRenderer.drawResult(ctx, MockState);
                }

                requestAnimationFrame(loop);
            }
            loop();
        });
    </script>
</body>

</html>