<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="https://atah.io/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preload"
        href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/KoddiUDOnGothic-Regular.woff" as="font"
        type="font/woff" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/KoddiUDOnGothic-Bold.woff"
        as="font" type="font/woff" crossorigin>
    <link rel="stylesheet" href="style.css">
    <title>atah.io</title>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PR4S897C');</script>
    <!-- End Google Tag Manager -->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PR4S897C" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <canvas id="gameCanvas"></canvas>

    <div id="header">
        <h1>All Things Archived Here</h1>
    </div>

    <div id="ui-layer">
        <div id="interaction-prompt" class="prompt hidden">Space를 누르세요.</div>

        <!-- Modals -->
        <div id="popup-minigames" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>아타호 미니게임</h2>
                <ul>
                    <li><a href="swim/index.html">헤엄치기</a></li>
                    <li><a href="balance/index.html">평균대 동작수련</a></li>
                </ul>
            </div>
        </div>

        <div id="popup-haiyuki" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>환세패유기</h2>
                <ul>
                    <li><a href="haiyuki_web/index.html">웹 버전</a> (ko) - 개발 중</li>
                    <li><a href="haiyuki_manual/index.html">매뉴얼</a> (ko)<br />
                        [<a href="haiyuki_manual/ref/manual_thebest.pdf">원본 1</a>, <a
                            href="haiyuki_manual/ref/manual_D4.pdf">원본 2</a>]</li>
                </ul>
            </div>
        </div>

        <div id="popup-gallery" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>환세 시리즈 일러스트</h2>
                <ul>
                    <li><a href="#resource/img/ds04.png">Disc Station 04</a></li>
                    <li><a href="#resource/img/ds10.png">Disc Station 10</a></li>
                    <li><a href="#resource/img/ds14.png">Disc Station 14</a></li>
                    <li><a href="#resource/img/ds20.png">Disc Station 20</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div id="footer">
        <p>
            Code magic by <a href="https://antigravity.google/">Google Antigravity</a> <span
                style="color: #333;">|</span>
            Everything else, merely collected by <a href="https://github.com/flvrdoyster">flvrdoyster</a> <span
                style="color: #333;">|</span>
            Visual and audio assets © original creators.
        </p>
    </div>

</body>

<script>window.MAP_NAME = 'cave';</script>
<!-- Game Data & Logic -->
<script src="world/maps/cave/data.js"></script>
<script src="world/maps/cave/triggers.js"></script>
<script src="world/system/loader.js"></script>

<div id="lightbox">
    <span class="close">&times;</span>
    <img id="lightbox-img" src="" alt="">
    <div id="lightbox-caption" class="caption"></div>
</div>

<script>
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const lightboxCaption = document.getElementById('lightbox-caption');
    const closeBtn = document.querySelector('#lightbox .close');

    function updateView() {
        const hash = window.location.hash.substring(1);
        // Simple security/validation: allow only resource/img path
        if (hash && hash.startsWith('resource/img/') && (hash.endsWith('.png') || hash.endsWith('.jpg') || hash.endsWith('.gif'))) {
            lightboxImg.src = hash;
            lightboxCaption.textContent = hash.split('/').pop(); // Show filename only
            lightbox.classList.add('active');
        } else {
            lightbox.classList.remove('active');
            // Don't clear src immediately to prevent flash if switching? 
            // Better to clear to stop loading if it was big.
            // lightboxImg.src = ''; 
        }
    }

    function closeLightbox() {
        // Clear hash
        history.pushState("", document.title, window.location.pathname + window.location.search);
        updateView();
    }

    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) closeLightbox();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeLightbox();
    });

    window.addEventListener('hashchange', updateView);
    window.addEventListener('DOMContentLoaded', updateView);
</script>

</html>